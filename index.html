<!-- ... باقي الكود بدون تغيير لحد قبل نهاية الـ script ... -->

    // مشاريع سلفيت
    $.getJSON("SalfitProjects.json", function(SP) {
      const blueIcon = L.icon({
        iconUrl: 'blue.png',
        iconSize: [25, 32], 
        iconAnchor: [10, 32],
        popupAnchor: [1, -34],
      });

      const siteDetails = {
        "BluElephant": { img: "BluElephant.png", text: "BluElephant is a compact Smart MBR system..." },
        "Salfeet Municipality": { img: "Gis.png", text: "Geographic Information System (GIS)..." },
        "Iskaka village council": { img: "Iskaka.png", text: "Collecting water network data in Iskaka..." },
        "Farkha village council": { img: "Farkha.png", text: "Collecting water network data in Farkha..." },
        "Flowless": { img: "flowless.jpg", text: "Flowless contributes to water sustainability..." },
        "Purification station ": { img: "Lab.jpeg", text: "Lab support in Salfit WWTP..." },
        // الخليل
        "Kharas Municipality": { img: "kharas.jpg", text: "BluElephant unit in Kharas..." },
        "North Hebron Monitoring": { img: "monitoring.jpg", text: "Monitoring and optimizing sanitation in North Hebron..." }
      };

      const addedCoords = [];

      function createProjectLayer(data) {
        return L.geoJson(data, {
          pointToLayer: function(feature, latlng) {
            const name = feature.properties.Name;
            const details = siteDetails[name] || { img: "default.jpg", text: "موقع غير محدد التفاصيل." };

            let newLatLng = latlng;
            const offset = 0.0003;

            while (addedCoords.some(coord => newLatLng.distanceTo(coord) < 10)) {
              newLatLng = L.latLng(newLatLng.lat + offset, newLatLng.lng + offset);
            }
            addedCoords.push(newLatLng);

            const marker = L.marker(newLatLng, { icon: blueIcon }).bindPopup(name);

            marker.on('click', function () {
              document.getElementById('info-title').innerText = name;
              document.getElementById('info-img').src = details.img;
              document.getElementById('info-text').innerText = details.text;
              document.getElementById('info-box').style.display = 'block';

              map.flyTo(newLatLng, 16, { animate: true, duration: 1.5 });
            });

            return marker;
          }
        });
      }

      // أضف طبقة سلفيت
      const LocationSalfit = createProjectLayer(SP);
      LocationSalfit.addTo(map);

      // أضف طبقة الخليل
      $.getJSON("HebronProjects.json", function(HP) {
        const LocationHebron = createProjectLayer(HP);
        LocationHebron.addTo(map);
      });
    });

    // تحريك الخريطة
    function panLeft() {
      map.panBy([-150, 0]);
    }

    function panRight() {
      map.panBy([150, 0]);
    }

    document.getElementById('left-button').addEventListener('click', panLeft);
    document.getElementById('right-button').addEventListener('click', panRight);
    document.getElementById('close-btn').addEventListener('click', function() {
    document.getElementById('info-box').style.display = 'none';
    });
